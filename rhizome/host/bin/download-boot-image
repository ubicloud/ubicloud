#!/bin/env ruby
# frozen_string_literal: true

unless (boot_image = ARGV.shift)
  puts "need boot_image as argument"
  exit 1
end

custom_url = ARGV.shift

require_relative "../../common/lib/util"
require_relative "../lib/boot_image"

certs = $stdin.read
ca_path = "/usr/lib/ssl/certs/ubicloud_images_blob_storage_certs.crt"
safe_write_to_file(ca_path, certs)

BootImage.new(boot_image, nil).download(url: custom_url, ca_path: ca_path)
