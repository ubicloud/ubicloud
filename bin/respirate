#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative "../loader"

d = Scheduling::Dispatcher.new

Thread.new do
  Ractor.receive_if { _1 == :thread_dump }
  Thread.list.each do |thread|
    puts "Thread: #{thread.inspect}"
    puts thread.backtrace&.join("\n")
  end
end

loop do
  d.wait_cohort
  d.start_cohort
  sleep 5
end
