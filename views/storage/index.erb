<% @page_title = "Storage Volumes" %>
<div class="auto-refresh hidden" data-interval="10"></div>

<% right_items = []
   if has_project_permission("DetachableVolume:create")
     right_items << part("components/button", text: "Create Storage Volume", link: "detachable-volume/create")
   end %>

<%== part(
  "components/page_header",
  breadcrumbs: [%w[Projects /project], [@project.name, @project.path], ["Storage", "#"]],
  right_items: right_items
) %>

<div class="grid gap-6">
  <%== part(
    "components/table_card",
    headers: ["Name", "Size", "Encryption", "Attached VM", "State"],
    rows: @detachable_volumes.map do |dv|
      [
        [
          [dv.name, {link: path(dv)}],
          "#{dv.size_gib} GB",
          dv.encrypted? ? "Encrypted" : "Unencrypted",
          dv.vm ? [dv.vm.name, {link: path(dv.vm)}] : "-",
          ["dv_state_label", {component: {state: dv.display_state}}]
        ],
        {id: "detachable-volume-#{dv.ubid}"}
      ]
    end,
    empty_state: {
      icon: "hero-circle-stack",
      title: "No storage volumes",
      description: has_project_permission("DetachableVolume:create") ? "Get started by creating a new storage volume." : "You don't have permission to create storage volumes.",
      buttons: has_project_permission("DetachableVolume:create") ? {"Create Storage Volume" => "#{@project.path}/detachable-volume/create"} : {}
    }
  ) %>
</div>
