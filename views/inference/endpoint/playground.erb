<% @page_title = "Playground" %>
<%== render("components/free_quota") %>
<% @enable_marked = true %>
<%== render("inference/tabbar") %>
<div class="table-card">
  <div class="form-section-padded content-grid">
    <div class="overview-grid text-primary">
      <%== render(
        "components/form/select",
        locals: {
          name: "inference_endpoint",
          label: "Inference Endpoint",
          placeholder: "Pick an endpoint",
          options: @inference_models.map { |ie|
            [ie.model_name, ie.model_name, nil, {
              "data-id": ie.ubid,
              "data-url": ie.load_balancer.health_check_url,
              "data-tags": ie.tags.to_json
            }]
          },
          selected: @inference_models.first&.model_name,
        }
      ) %>
      <%== render(
        "components/form/select",
        locals: {
          name: "inference_api_key",
          label: "Inference API Key",
          placeholder: "Pick a key",
          options: @inference_api_keys.map { [it.key, it.ubid] },
          selected: @inference_api_keys.first&.key
        }
      ) %>
    </div>
    <%== part(
      "components/form/checkbox",
      name: "inference_config",
      options: [["show_advanced", "Show advanced settings", nil, nil]]
    ) %>
    <div class="inference-config-section" id="inference_config_advanced_settings">
      <div class="overview-grid text-primary">
        <%== render(
          "components/form/text",
          locals: {
            name: "inference_temperature",
            label: "Temperature (Optional)",
            type: "number",
            attributes: {
              "placeholder" => 1.0,
              "min" => 0.0,
              "max" => 2.0,
            },
            extra_class: "number-input-no-spinner"
          }
        ) %>
        <%== render(
          "components/form/text",
          locals: {
            name: "inference_top_p",
            label: "Top P (Optional)",
            type: "number",
            attributes: {
              "placeholder" => 1.0,
              "min" => 0.0,
              "max" => 1.0,
            },
            extra_class: "number-input-no-spinner"
          }
        ) %>
      </div>
      <div>
        <%== render(
          "components/form/textarea",
          locals: {
            name: "inference_system",
            label: "System Message (Optional)",
            attributes: {
              "placeholder" => "System message to be submitted to the inference endpoint",
              "rows" => 3,
            },
          }
        ) %>
      </div>
    </div>
  </div>
  <div class="form-section-padded content-grid">
    <div>
      <%== render(
        "components/button",
        locals: {
          text: "Start a new chat",
          attributes: {
            "id" => "inference_new_chat",
            "type" => "button"
          }
        }
      ) %>
    </div>
    <div>
      <div class="inference-previous-messages-label">Previous Messages</div>
      <div id="inference_previous_empty" class="help-text">There are no messages yet.</div>
      <div id="inference_previous">
      </div>
    </div>
    <div>
      <%== render(
        "components/form/textarea",
        locals: {
          name: "inference_prompt",
          label: "New Message",
          attributes: {
            "autofocus" => true,
            "placeholder" => "User prompt to be submitted to the inference endpoint",
            "rows" => 3,
          },
        }
      ) %>
      <div class="inference-controls-grid">
        <div class="inference-control-row">
          <input
            type="file"
            id="inference_files"
            accept=".jpg,.jpeg,.png,.pdf"
            class="inline-icon-label"
            multiple
            aria-label="Upload files"
          >
        </div>
        <div class="inference-control-row-end">
          <%== render(
            "components/button",
            locals: {
              text: "Submit",
              attributes: {
                "name" => "inference_submit",
                "id" => "inference_submit",
                "type" => "button"
              },
            }
          ) %>
        </div>
      </div>
    </div>
  </div>
</div>
