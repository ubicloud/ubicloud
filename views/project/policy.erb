<% @page_title = "#{@project_data[:name]} - Policy" %>

<div class="px-2 sm:px-3 lg:px-4">
  <div class="space-y-1">
    <%== render(
      "components/breadcrumb",
      locals: {
        back: "/project",
        parts: [%w[Projects /project], [@project_data[:name], @project_data[:path]], %w[Policy #]]
      }
    ) %>
    <%== render("components/page_header", locals: { title: "Update Access Policy" }) %>
  </div>

  <div class="mt-8 flow-root">
    <div class="py-2 -mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8 align-middle sm:px-6 lg:px-8">
      <div class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 sm:rounded-lg bg-white text-sm text-gray-500">
        <div class="divide-y divide-gray-200 lg:col-span-10 pb-10">
          <form action="<%= "#{@project_data[:path]}/policy/#{@policy[:ulid]}" %>" role="form" method="POST">
            <%== csrf_tag("#{@project_data[:path]}/policy/#{@policy[:ulid]}") %>
            <div class="px-4 py-6 sm:p-6 lg:pb-8 space-y-4">
              <div class="grid grid-cols-12 gap-6">
                <div class="col-span-full">
                  <div class="policy-editor">
                    <pre class="bg-gray-50 rounded-lg p-3 h-[60vh] overflow-scroll" contenteditable="true">
                      <%= flash.dig("old", "body") || @policy[:body] %>
                    </pre>
                    <textarea name="body" class="hidden" required></textarea>
                  </div>
                </div>
                <div class="col-span-3 sm:col-span-6">
                  <%== render("components/form/submit_button", locals: { text: "Update" }) %>
                </div>
              </div>
            </div>
          </form>
          <div class="mt-12 px-4 py-6 sm:px-6">
            <h4 class="font-medium text-gray-900 text-lg">Access Policy Language</h4>
            <p class="mt-2">
              Access policies have 3 main parts: subjects, actions, and objects. All of them can be a single string or
              a list of strings.
              <span class="text-gray-700 font-medium">"project/&lt;PROJECT_ID&gt;"</span>,
              <span class="text-gray-700 font-medium">"user/&lt;EMAIL&gt;"</span>,
              <span class="text-gray-700 font-medium">"project/&lt;PROJECT_ID&gt;/location/&lt;LOCATION_NAME&gt;/vm/&lt;VM_NAME&gt;"</span>
              or custom tags can be used for subjects, and objects. To use a tag in policy, it should have to
              assoaciated with the project. Actions are predefined.
            </p>
            <table class="mt-4 min-w-full divide-y divide-gray-300 text-left text-sm">
              <thead class="font-semibold">
                <tr>
                  <th scope="col" class="px-2 py-3.5 text-gray-900 border">Action</th>
                  <th scope="col" class="px-2 py-3.5 text-gray-900 border">Description</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200 ">
                <tr>
                  <td class="px-2 py-2 text-gray-500 border">Vm:view</td>
                  <td class="px-2 py-2 text-gray-500 border">Grants permission to view Vm resources</td>
                </tr>
                <tr>
                  <td class="px-2 py-2 text-gray-500 border">Vm:create</td>
                  <td class="px-2 py-2 text-gray-500 border">Grants permission to create Vm in Project</td>
                </tr>
                <tr>
                  <td class="px-2 py-2 text-gray-500 border">Vm:delete</td>
                  <td class="px-2 py-2 text-gray-500 border">Grants permission to delete Vm</td>
                </tr>
                <tr>
                  <td class="px-2 py-2 text-gray-500 border">Project:view</td>
                  <td class="px-2 py-2 text-gray-500 border">Grants permission to view Project details</td>
                </tr>
                <tr>
                  <td class="px-2 py-2 text-gray-500 border">Project:delete</td>
                  <td class="px-2 py-2 text-gray-500 border">Grants permission to delete Project</td>
                </tr>
                <tr>
                  <td class="px-2 py-2 text-gray-500 border">Project:user</td>
                  <td class="px-2 py-2 text-gray-500 border">Grants permission to add/remove users to/from Project</td>
                </tr>
                <tr>
                  <td class="px-2 py-2 text-gray-500 border">Project:policy</td>
                  <td class="px-2 py-2 text-gray-500 border">Grants permission to update Project's access policies</td>
                </tr>
              </tbody>
            </table>
            <p class="mt-2">
              Be careful while updating policy, if you remove your project permissions, you may lose your access to
              this project.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
