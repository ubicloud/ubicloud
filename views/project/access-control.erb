<% @page_title = "#{@project_data[:name]} - Access Control" %>
<%== render("project/user-tabbar") %>

<div class="space-y-1">
  <%== render(
    "components/page_header",
    locals: {
      title: "Access Control",
      breadcrumbs: [%w[Projects /project], [@project_data[:name], @project_data[:path]], ["Access Control", "#"]]
    }
  ) %>
</div>

<div class="grid gap-6">
  <div>
    <div class="md:flex md:items-center md:justify-between pb-1 lg:pb-2">
      <div class="min-w-0 flex-1">
        Access control in ubicloud is defined using access control entries. Each access control entry has a single
        subject, action, and object. Access is allowed if there is an access control entry allowing the subject to take
        the action on the object. Subjects, actions, and objects can all be tags, which are used for grouping. The
        recommended way to handle access control in Ubicloud is to create appropriate tags, add the subjects, actions,
        and objects to the tags, and create the minimum number of access control entries you need to enforce the access
        you want. However, you can create access control entries referencing specific subjects, actions, or objects.
      </div>
      <div class="mb-2 md:mb-0">
        <%== render(
          "components/button",
          locals: {
            text: "Create Access Control Entry",
            link: "#{@project_data[:path]}/user/access-control/entry/new"
          }
        ) %>
      </div>
    </div>

    <div class="overflow-hidden rounded-lg shadow ring-1 ring-black ring-opacity-5 bg-white divide-y divide-gray-200">
      <table id="access-control-entries" class="min-w-full divide-y divide-gray-300">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"></th>
            <% %w[Subject Action Object].each do |type| %>
              <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">
                <%= type %>
              </th>
            <% end %>
            <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"></th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200 bg-white">
          <% @aces.each do |ubid, tags, editable| %>
            <tr id="ace-<%= ubid %>">
              <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6" scope="row">
                <% if editable %>
                  <%== render("components/button", locals: { text: "Edit", link: "#{@project_data[:path]}/user/access-control/entry/#{ubid}" }) %>
                <% end %>
              </td>
              <% tags.each do |tag| %>
                <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                  <%= ace_label(tag) %>
                </td>
              <% end %>
              <td class="py-4 pl-3 pr-4 text-right sm:pr-6">
                <% if editable %>
                  <%== render(
                    "components/delete_button",
                    locals: {
                      text: "Remove",
                      url: "#{@project_data[:path]}/user/access-control/entry/#{ubid}",
                      confirmation: "delete entry"
                    }
                  ) %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
