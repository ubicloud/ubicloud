<% @enable_echarts = true %>

<div id="metrics-container" class="section-padded" data-metrics-url="<%= path(@pg) %>">
  <% if @pg.display_state != "creating" %>
    <div class="spaced-bottom-md flex-end gap-2">
      <select
        id="time-range"
        class="py-1.5 rounded-md   "
        name="time-range"
      >
        <option value="30m">Last 30 minutes</option>
        <option value="1h" selected>Last 1 hour</option>
        <option value="3h">Last 3 hours</option>
        <option value="6h">Last 6 hours</option>
        <option value="12h">Last 12 hours</option>
        <option value="1d">Last 1 day</option>
        <option value="2d">Last 2 days</option>
        <option value="7d">Last 7 days</option>
        <option value="30d">Last 30 days</option>
      </select>
      <%== part("components/button", attributes: {id: "refresh-button"}, text: "  Refresh", type: "primary", icon: "hero-refresh") %>
    </div>
    <div class="chart-grid chart-grid-no-border-top">
      <% Metrics::POSTGRES_METRICS.each do |key, metric| %>
        <div class="metric-card">
          <h4 class="chart-title"><%= metric.name %></h4>
          <p class="text-muted-spaced-sm"><%= metric.description %></p>
          <div
            class="metric-chart chart-container"
            id="<%= key %>-chart"
            data-metric-key="<%= key %>"
            data-metric-unit="<%= metric.unit %>"
          >
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="empty-state-centered">
      <h2 class="empty-state-heading">No metrics available</h2>
      <p class="text-muted-spaced">Metrics will be available once the database is running.</p>
    </div>
  <% end %>
</div>

<div class="section-padded">
  <div class="flex-header">
    <div class="flex-title">
      <h3>
        Metric Destinations
      </h3>
    </div>
  </div>
  <div class="table-card">
    <table class="table">
      <thead class="table-header-bg">
        <tr>
          <th scope="col">URL</th>
          <th scope="col">Username</th>
          <th scope="col">Password</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody class="table-body-bg">
        <% @pg.metric_destinations.each do |md| %>
          <tr>
            <td><%= md.url %></td>
            <td><%= md.username %></td>
            <td>-</td>
            <td
              id="md-delete-<%=md.ubid %>"
             
            >
              <%== part("components/delete_button", url: "#{path(@pg)}/metric-destination/#{md.ubid}", text: "") %>
            </td>
          </tr>
        <% end %>
        <tr>
          <td>
            <%== part("components/form/text", name: "url", attributes: { form: "form-pg-md-create", required: true }) %>
          </td>
          <td>
            <%== part("components/form/text", name: "username", attributes: { form: "form-pg-md-create", required: true }) %>
          </td>
          <td>
            <%== part(
                "components/form/text",
                name: "metric-destination-password",
                type: "password",
                attributes: {
                  required: true,
                  form: "form-pg-md-create",
                  autocomplete: "new-password"
                },
                extra_class: "metric-destination-password"
              ) %>
          </td>
          <td>
            <% form(action: "#{path(@pg)}/metric-destination", method: :post, id: "form-pg-md-create") do %>
              <%== part("components/form/submit_button", text: "Create", extra_class: "metric-destination-create-button") %>
            <% end %>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
