<% @content_class = "" %>


<% unless @grouped_pages.empty? %>
  <table class="page-table">
    <caption>Active Pages</caption>
    <thead>
      <tr>
	<th>VmHost</th>
	<th>UBID</th>
	<th>Created At</th>
	<th>Summary</th>
	<th>Details</th>
      </tr>
    </thead>
    <tbody>
      <% @grouped_pages.sort_by { |k,| k || "z" }.each do |vmh_ubid, pages| %>
        <% pages.each_with_index do |page, index| %>
          <tr>
            <% if index == 0 %>
              <td rowspan="<%= pages.size %>">
                <% if vmh_ubid %>
                  <a href="/model/VmHost/<%= vmh_ubid %>"><%= vmh_ubid %></a>
                <% end%>
              </td>
            <% end %>

            <td><a href="/model/Page/<%= page.ubid %>"><%= page.ubid %></a></td>
            <td><%= page.created_at.strftime("%F %T") %></td>
            <td><%= page.summary %></td>
            <td><%== linkify_ubids(page.details) %></td>
          </tr>
         <% end %>
       <% end %>
    </tbody>
  </table>
<% end %>

<div class="container">
  <h2>Browse by Model Class</h2>

  <ul id="model-class-list">
    <% autoforme_models = self.class.autoforme_framework.models %>
    <% @classes.each do |klass| %>
      <li><a href="<%= autoforme_models[klass.to_s] ? "/autoforme/#{klass}/browse" : "/model/#{klass}" %>"><%= klass %></a></li>
    <% end %>
  </ul>

  <h2 class="container">Manage</h2>

  <ul>
    <li><a href="/change-password">Change Password</a></li>
    <li><a href="/multifactor-manage">Manage Multifactor Authentication</a></li>
  </ul>

  <% if @annotations.any? %>
    <h2>Annotations</h2>
    <table class="annotation-table">
      <thead>
        <tr>
          <th>Description</th>
          <th>Related Resources</th>
          <th>CreatedAt</th>
        </tr>
      </thead>
      <tbody>
        <% @annotations.each do |annotation| %>
          <tr>
            <td><a href="/model/Annotation/<%= annotation.ubid %>"><%= annotation.description %></a></td>
            <td>
              <% if annotation.related_resources&.any? %>
                <% annotation.related_resources.each do |resource_id| %>
                  <% ubid = UBID.from_uuidish(resource_id) %>
                  <% ubid_class = UBID.class_for_ubid(ubid.to_s).name %>
                  <a href="/model/<%= ubid_class %>/<%= ubid %>"><%= ubid %></a><br>
                <% end %>
              <% else %>
                <em>No related resources</em>
              <% end %>
            </td>
            <td><%= annotation.created_at.strftime("%F %T") %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>
</div>
